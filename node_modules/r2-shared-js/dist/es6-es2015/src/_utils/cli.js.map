{"version":3,"file":"cli.js","sourceRoot":"","sources":["../../../../src/_utils/cli.ts"],"names":[],"mappings":";;;AAOA,iCAAiC;AACjC,6CAA6C;AAC7C,yBAAyB;AACzB,sCAAsC;AACtC,6BAA6B;AAC7B,6BAA0B;AAC1B,6BAA6B;AAE7B,yDAAyD;AACzD,qDAAkD;AAClD,+DAAgD;AAChD,iDAAwE;AACxE,yCAAgE;AAChE,yEAA4E;AAC5E,uCAA8C;AAC9C,iEAAkE;AAClE,mEAAqE;AACrE,oDAAoE;AACpE,0DAAiG;AACjG,gEAA2D;AAC3D,wEAA+E;AAE/E,wDAAsD;AAEtD,kDAA4F;AAC5F,+CAA4C;AAK5C,IAAA,0CAA2B,GAAE,CAAC;AAC9B,IAAA,2CAA4B,GAAE,CAAC;AAE/B,IAAA,4BAAsB,EAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC,CAAC;AAEpE,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;AAC9B,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC;AAE3B,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;AAC3B,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AAEvB,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACnC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AACrB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;AAElB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;IACX,OAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;IAC7C,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACpB,CAAC;AACD,MAAM,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AAC/B,IAAI,QAAQ,GAAG,OAAO,CAAC;AACvB,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AAEtB,IAAI,CAAC,IAAA,iBAAM,EAAC,QAAQ,CAAC,EAAE,CAAC;IACpB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC;QAC3B,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;QACzC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACtB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC3B,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,OAAO,CAAC,CAAC;YAC7C,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACtB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC;gBAC3B,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;gBACxC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACpB,CAAC;QACL,CAAC;IACL,CAAC;IAED,MAAM,KAAK,GAAG,EAAE,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;IACrC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,CAAC;QAC1C,OAAO,CAAC,GAAG,CAAC,qCAAqC,CAAC,CAAC;QACnD,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IACpB,CAAC;AACL,CAAC;AAED,IAAI,QAAQ,GAAG,QAAQ,CAAC;AACxB,IAAI,IAAA,iBAAM,EAAC,QAAQ,CAAC,EAAE,CAAC;IACnB,MAAM,GAAG,GAAG,IAAI,SAAG,CAAC,QAAQ,CAAC,CAAC;IAC9B,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;AAC5B,CAAC;AACD,QAAQ,GAAG,QAAQ,CAAC,OAAO,CAAC,+BAA+B,EAAE,EAAE,CAAC,CAAC;AACjE,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AAEnC,IAAI,8BAA8B,GAAG,KAAK,CAAC;AAC3C,IAAI,WAAiC,CAAC;AACtC,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;IACV,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,oCAAoC,EAAE,CAAC;QACnD,8BAA8B,GAAG,IAAI,CAAC;IAC1C,CAAC;SAAM,CAAC;QACJ,WAAW,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC5C,CAAC;AACL,CAAC;AAED,IAAI,aAAiC,CAAC;AACtC,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;IACV,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;IAC9B,IAAI,OAAO,GAAG,MAAM,CAAC;IACrB,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IACrB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;QAC1B,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QACvC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACrB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;YAC1B,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,CAAC;YAC3C,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YACrB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;gBAC1B,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;gBACvC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACpB,CAAC;iBAAM,CAAC;gBACJ,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC;oBACvC,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;oBAC1C,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;gBACpB,CAAC;YACL,CAAC;QACL,CAAC;IACL,CAAC;IAED,OAAO,GAAG,EAAE,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;IAEnC,IAAI,8BAA8B,EAAE,CAAC;QACjC,aAAa,GAAG,OAAO,CAAC;QAExB,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;IAO/B,CAAC;SAAM,CAAC;QACJ,MAAM,aAAa,GAAG,QAAQ,GAAG,eAAe,CAAC;QACjD,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAC3B,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;QAElD,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAC3B,IAAI,EAAE,CAAC,UAAU,CAAC,aAAa,CAAC,EAAE,CAAC;YAC/B,OAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;YAC7C,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACpB,CAAC;IACL,CAAC;AACL,CAAC;AAGD,CAAC,GAAS,EAAE;;IACR,IAAI,WAAwB,CAAC;IAC7B,IAAI,CAAC;QACD,WAAW,GAAG,MAAM,IAAA,4CAAuB,EAAC,QAAQ,CAAC,CAAC;IAC1D,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACX,OAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;QAC7C,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,OAAO;IACX,CAAC;IAED,MAAM,QAAQ,GAAG,IAAA,qBAAc,EAAC,QAAQ,CAAC,CAAC;IAC1C,IAAI,aAAsC,CAAC;IAC3C,IAAI,CAAC;QACD,aAAa,GAAG,MAAM,IAAA,kCAAsB,EAAC,QAAQ,CAAC,CAAC;IAC3D,CAAC;IAAC,OAAO,IAAI,EAAE,CAAC;IAGhB,CAAC;IACD,IAAI,WAAoC,CAAC;IACzC,IAAI,CAAC;QACD,WAAW,GAAG,MAAM,IAAA,0BAAkB,EAAC,QAAQ,CAAC,CAAC;IACrD,CAAC;IAAC,OAAO,IAAI,EAAE,CAAC;IAGhB,CAAC;IAED,IAAI,CAAC,WAAW,IAAI,aAAa,IAAI,QAAQ,CAAC,IAAI,aAAa,EAAE,CAAC;QAC9D,IAAI,CAAC;YACD,IAAI,WAAW,EAAE,CAAC;gBACd,MAAM,IAAA,mDAA2B,EAC7B,aAAa,EACb,WAAW,EACX,8BAA8B,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;gBAE3D,MAAM,eAAe,GAAG,CAAA,MAAA,WAAW,CAAC,QAAQ,0CAAE,cAAc;oBAExD,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,oBAAoB,CAAC,KAAK,eAAe;wBAC9E,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,oBAAoB,CAAC,KAAK,eAAe,IAAI,CAC7E,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,oBAAoB,CAAC;wBAC1D,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,oBAAoB,CAAC,CAC7D,CAAC,CAAC;gBACP,IAAI,eAAe,IAAI,CAAC,CAAA,MAAA,WAAW,CAAC,KAAK,0CAAE,MAAM,CAAA,EAAE,CAAC;oBAChD,OAAO,CAAC,GAAG,CAAC,uEAAuE,CAAC,CAAC;oBACrF,WAAW,CAAC,WAAW,EAAE,CAAC;oBAC1B,IAAI,CAAC;wBACD,WAAW,GAAG,MAAM,IAAA,4CAAuB,EAAC,QAAQ,CAAC,CAAC;oBAC1D,CAAC;oBAAC,OAAO,GAAG,EAAE,CAAC;wBACX,OAAO,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;wBAC7C,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;wBACjB,OAAO;oBACX,CAAC;oBAED,MAAM,IAAI,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;wBACvB,UAAU,CAAC,GAAS,EAAE;4BAClB,IAAI,CAAC,MAAM,IAAA,mDAA2B,EAClC,aAAc,EACd,WAAW,EACX,8BAA8B,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS,EACrD,IAAI,CAAC,CAAC,CAAC;wBACf,CAAC,CAAA,EAAE,GAAG,CAAC,CAAC;oBACZ,CAAC,CAAC,CAAC;gBACP,CAAC;YACL,CAAC;iBAAM,CAAC;gBACJ,MAAM,WAAW,CAAC,CAAC,QAAQ,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,EAAE,WAAW,EAAE,aAAa,EAAE,WAAW,CAAC,CAAC;YACzG,CAAC;QACL,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,6BAA6B,CAAC,CAAC;YAC3C,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,OAAO;QACX,CAAC;IACL,CAAC;SAAM,CAAC;QACJ,MAAM,eAAe,CAAC,WAAW,CAAC,CAAC;IACvC,CAAC;AACL,CAAC,CAAA,CAAC,EAAE,CAAC;AAEL,SAAS,wBAAwB,CAAC,GAAgB,EAAE,MAAc,EAAE,IAA0B;IAE1F,MAAM,YAAY,GAAG,IAAA,8BAAe,EAAC,GAAG,CAAC,CAAC;IAE1C,MAAM,QAAQ,GAAG,EAAE,CAAC;IACpB,IAAI,YAAY,CAAC,YAAY,EAAE,CAAC;QAC5B,QAAQ,CAAC,IAAI,CAAC,GAAI,YAAY,CAAC,YAA0B,CAAC,CAAC;IAC/D,CAAC;IACD,IAAI,YAAY,CAAC,SAAS,EAAE,CAAC;QACzB,QAAQ,CAAC,IAAI,CAAC,GAAI,YAAY,CAAC,SAAuB,CAAC,CAAC;IAC5D,CAAC;IAED,IAAI,IAAI,EAAE,CAAC;QAEP,QAAQ,CAAC,OAAO,CAAC,CAAC,IAAS,EAAE,EAAE;YAC3B,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS;gBAC5C,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,KAAK,gCAAgC,EAAE,CAAC;gBACxE,OAAO,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC;gBAEjC,IAAI,UAAU,GAAG,KAAK,CAAC;gBACvB,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC/C,IAAI,SAAS,EAAE,CAAC;oBACZ,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;wBAC3B,IAAI,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,CAAC;4BAC3C,UAAU,GAAG,IAAI,CAAC;4BAClB,OAAO,KAAK,CAAC;wBACjB,CAAC;wBACD,OAAO,IAAI,CAAC;oBAChB,CAAC,CAAC,CAAC;gBACP,CAAC;gBACD,IAAI,CAAC,UAAU,EAAE,CAAC;oBACd,OAAO,IAAI,CAAC,UAAU,CAAC;gBAC3B,CAAC;YACL,CAAC;QACL,CAAC,CAAC,CAAC;QACH,IAAI,YAAY,CAAC,KAAK,EAAE,CAAC;YACrB,MAAM,GAAG,GAAI,YAAY,CAAC,KAAmB,CAAC;YAC9C,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;YACf,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;gBAClC,MAAM,IAAI,GAAG,GAAG,CAAC,CAAC,CAAY,CAAC;gBAC/B,IAAI,IAAI,CAAC,IAAI,KAAK,+CAA+C;uBAC1D,IAAI,CAAC,GAAG,KAAK,SAAS,EAAE,CAAC;oBAC5B,KAAK,GAAG,CAAC,CAAC;oBACV,MAAM;gBACV,CAAC;YACL,CAAC;YACD,IAAI,KAAK,IAAI,CAAC,EAAE,CAAC;gBACb,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YACzB,CAAC;YACD,IAAI,GAAG,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;gBACnB,OAAO,YAAY,CAAC,KAAK,CAAC;YAC9B,CAAC;QACL,CAAC;IACL,CAAC;IAGD,QAAQ,CAAC,OAAO,CAAC,CAAC,IAAS,EAAE,EAAE;QAC3B,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS;YAC5C,CAAC,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,KAAK,oCAAoC;gBACzE,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,KAAK,gCAAgC,CAAC,EAAE,CAAC;YAChF,OAAO,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC;YAEjC,IAAI,UAAU,GAAG,KAAK,CAAC;YACvB,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC/C,IAAI,SAAS,EAAE,CAAC;gBACZ,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,EAAE;oBAC3B,IAAI,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,CAAC;wBAC3C,UAAU,GAAG,IAAI,CAAC;wBAClB,OAAO,KAAK,CAAC;oBACjB,CAAC;oBACD,OAAO,IAAI,CAAC;gBAChB,CAAC,CAAC,CAAC;YACP,CAAC;YACD,IAAI,CAAC,UAAU,EAAE,CAAC;gBACd,OAAO,IAAI,CAAC,UAAU,CAAC;YAC3B,CAAC;QACL,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,MAAM,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IAGjE,MAAM,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;IAC5D,EAAE,CAAC,aAAa,CAAC,gBAAgB,EAAE,eAAe,EAAE,MAAM,CAAC,CAAC;AAChE,CAAC;AAED,SAAe,iBAAiB,CAAC,GAAS,EAAE,MAAc;;QACtD,IAAI,UAAgC,CAAC;QACrC,IAAI,CAAC;YACD,UAAU,GAAG,MAAM,GAAG,CAAC,UAAU,EAAE,CAAC;QACxC,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACrB,CAAC;QACD,IAAI,UAAU,EAAE,CAAC;YACb,KAAK,MAAM,QAAQ,IAAI,UAAU,EAAE,CAAC;gBAChC,IAAI,QAAQ,KAAK,UAAU;oBACvB,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,CAAC;oBACjC,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC;oBACzB,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC;oBAC7B,QAAQ,KAAK,kBAAkB;oBAC/B,QAAQ,KAAK,cAAc;oBAC3B,CAAC,QAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC;oBAC/B,CAAC,QAAQ,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE,CAAC;oBAEpC,MAAM,kBAAkB,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;oBACvD,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,kBAAkB,CAAC,EAAE,CAAC;wBACrC,OAAO,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;wBACzC,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;oBACpC,CAAC;gBACL,CAAC;YACL,CAAC;QACL,CAAC;IACL,CAAC;CAAA;AAED,SAAe,uBAAuB,CAAC,GAAgB,EAAE,IAA0B;;QAE/E,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;YACpB,OAAO;QACX,CAAC;QAED,MAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE;YACnC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YACnB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAIjB,IAAI,GAAG,CAAC,MAAM,KAAK,EAAE,EAAE,CAAC;gBACpB,IAAI,KAAK,GAAG,IAAI,CAAC;gBACjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC;oBAErC,MAAM,OAAO,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;oBAE/C,MAAM,SAAS,GAAG,QAAQ,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;oBACxC,IAAI,KAAK,CAAC,SAAS,CAAC,EAAE,CAAC;wBACnB,KAAK,GAAG,KAAK,CAAC;wBACd,MAAM;oBACV,CAAC;gBAYL,CAAC;gBACD,IAAI,KAAK,EAAE,CAAC;oBACR,OAAO,GAAG,CAAC;gBACf,CAAC;YACL,CAAC;YAED,MAAM,QAAQ,GAAG,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;YAC7C,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACrB,MAAM,YAAY,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAC5C,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;YAC1B,OAAO,YAAY,CAAC;QAIxB,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC;YACD,MAAM,GAAG,CAAC,GAAG,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QAC7C,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,MAAM,KAAK,CAAC,oCAAoC,CAAC,CAAC;QA8BtD,CAAC;IACL,CAAC;CAAA;AAED,SAAe,gBAAgB,CAAC,GAAgB,EAAE,GAAS,EAAE,MAAc,EAAE,IAAU;;QAEnF,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;QACrC,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAG,WAAW,CAAC,CAAC;QACpC,IAAI,CAAC,WAAW,EAAE,CAAC;YACf,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;YAClC,OAAO;QACX,CAAC;QAED,MAAM,GAAG,GAAG,MAAM,IAAA,yBAAW,EAAC,GAAG,EAAE,WAAW,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3D,IAAI,CAAC,GAAG,EAAE,CAAC;YACP,OAAO,CAAC,GAAG,CAAC,kCAAkC,IAAI,CAAC,IAAI,QAAQ,WAAW,EAAE,CAAC,CAAC;YAC9E,MAAM,UAAU,GAAG,MAAM,GAAG,CAAC,UAAU,EAAE,CAAC;YAC1C,KAAK,MAAM,QAAQ,IAAI,UAAU,EAAE,CAAC;gBAChC,IAAI,QAAQ,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE,CAAC;oBACnC,SAAS;gBACb,CAAC;gBACD,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YAC1B,CAAC;YACD,OAAO;QACX,CAAC;QAED,IAAI,UAA4B,CAAC;QACjC,IAAI,CAAC;YACD,UAAU,GAAG,MAAM,GAAG,CAAC,kBAAkB,CAAC,WAAW,CAAC,CAAC;QAC3D,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YACzB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,OAAO;QACX,CAAC;QAED,IAAI,iBAAmC,CAAC;QACxC,IAAI,CAAC;YACD,iBAAiB,GAAG,MAAM,0BAAY,CAAC,SAAS,CAC5C,GAAG,EAAE,IAAI,EAAE,SAAS,EACpB,UAAU,EACV,KAAK,EACL,CAAC,EACD,CAAC,EACD,SAAS,CACZ,CAAC;QACN,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YAEX,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YACzB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,OAAO;QACX,CAAC;QAKD,UAAU,GAAG,iBAAiB,CAAC;QAE/B,IAAI,OAAe,CAAC;QACpB,IAAI,CAAC;YACD,OAAO,GAAG,MAAM,IAAA,mCAAqB,EAAC,UAAU,CAAC,MAAM,CAAC,CAAC;QAC7D,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;YACzB,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,OAAO;QACX,CAAC;QAGD,MAAM,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;QACtD,UAAU,CAAC,cAAc,CAAC,CAAC;QAC3B,EAAE,CAAC,aAAa,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;IAC9C,CAAC;CAAA;AAED,SAAe,WAAW,CAAC,MAAe,EAAE,GAAgB,EAAE,MAAc,EAAE,IAA0B;;QAKpG,MAAM,WAAW,GAAG,GAAG,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;QAChD,IAAI,CAAC,WAAW,EAAE,CAAC;YACf,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;YACpC,OAAO;QACX,CAAC;QAED,MAAM,GAAG,GAAG,WAAW,CAAC,KAAa,CAAC;QAEtC,IAAI,CAAC;YACD,MAAM,uBAAuB,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QAC7C,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,MAAM,GAAG,CAAC;QACd,CAAC;QAGD,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC,CAAC;QAEhD,IAAI,CAAC;YACD,MAAM,yBAAyB,CAAC,GAAG,EAAE,GAAG,EAAE,MAAM,CAAC,CAAC;QACtD,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACrB,CAAC;QAED,wBAAwB,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;QAE5C,MAAM,KAAK,GAAG,EAAE,CAAC;QACjB,IAAI,GAAG,CAAC,SAAS,EAAE,CAAC;YAChB,KAAK,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,SAAS,CAAC,CAAC;QACjC,CAAC;QACD,IAAI,GAAG,CAAC,KAAK,EAAE,CAAC;YACZ,KAAK,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC;QAMD,IAAI,CAAC,IAAI,EAAE,CAAC;YACR,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,cAAc,CAAC;YACzD,MAAM,GAAG,GAAG,MAAM,IAAA,yBAAW,EAAC,GAAG,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC;YACnD,IAAI,GAAG,EAAE,CAAC;gBACN,MAAM,CAAC,GAAG,IAAI,uBAAI,EAAE,CAAC;gBACrB,CAAC,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;gBACtB,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAClB,CAAC;QACL,CAAC;QACD,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;YACvB,IAAI,CAAC;gBACD,MAAM,gBAAgB,CAAC,GAAG,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;YACnD,CAAC;YAAC,OAAO,GAAG,EAAE,CAAC;gBACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACrB,CAAC;QACL,CAAC;QAED,IAAI,CAAC;YACD,MAAM,iBAAiB,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QACzC,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACrB,CAAC;IACL,CAAC;CAAA;AAED,SAAe,yBAAyB,CAAC,GAAgB,EAAE,IAAU,EAAE,MAAc;;QAEjF,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAC;YACb,OAAO;QACX,CAAC;QAED,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;QACX,KAAK,MAAM,SAAS,IAAI,GAAG,CAAC,KAAK,EAAE,CAAC;YAEhC,IAAI,SAAS,CAAC,aAAa,EAAE,CAAC;gBAC1B,MAAM,EAAE,GAAG,SAAS,CAAC,aAAa,CAAC;gBAKnC,IAAI,CAAC;oBAED,MAAM,IAAA,yCAAqB,EAAC,GAAG,EAAE,EAAE,CAAC,CAAC;gBACzC,CAAC;gBAAC,OAAO,GAAG,EAAE,CAAC;oBAEX,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBAC/B,CAAC;gBACD,MAAM,SAAS,GAAG,IAAA,8BAAe,EAAC,EAAE,CAAC,CAAC;gBACtC,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gBAE/D,CAAC,EAAE,CAAC;gBACJ,MAAM,CAAC,GAAG,kBAAkB,CAAC,OAAO,CAAC;gBAErC,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;gBACxC,EAAE,CAAC,aAAa,CAAC,UAAU,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC;gBAEhD,IAAI,SAAS,CAAC,UAAU,IAAI,SAAS,CAAC,UAAU,CAAC,YAAY,EAAE,CAAC;oBAC5D,SAAS,CAAC,UAAU,CAAC,YAAY,GAAG,CAAC,CAAC;gBAC1C,CAAC;gBACD,IAAI,SAAS,CAAC,SAAS,EAAE,CAAC;oBACtB,KAAK,MAAM,OAAO,IAAI,SAAS,CAAC,SAAS,EAAE,CAAC;wBACxC,IAAI,OAAO,CAAC,QAAQ,KAAK,+BAA+B,EAAE,CAAC;4BACvD,OAAO,CAAC,IAAI,GAAG,CAAC,CAAC;wBACrB,CAAC;oBACL,CAAC;gBACL,CAAC;YACL,CAAC;QACL,CAAC;IACL,CAAC;CAAA;AAED,SAAS,UAAU,CAAC,MAAc;IAC9B,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAErC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;QAC1B,UAAU,CAAC,OAAO,CAAC,CAAC;QACpB,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;IAC1B,CAAC;AACL,CAAC;AAED,SAAe,eAAe,CAAC,WAAwB;;QAEnD,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;QAEhC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,EAChC,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAE5E,MAAM,kBAAkB,GAAG,IAAA,8BAAe,EAAC,WAAW,CAAC,CAAC;QACxD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,kBAAkB,EACvC,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAE5E,MAAM,kBAAkB,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAIjF,MAAM,kBAAkB,GAAG,IAAA,gCAAiB,EAAC,kBAAkB,EAAE,yBAAW,CAAC,CAAC;QAG9E,MAAM,yBAAyB,GAAG,IAAA,8BAAe,EAAC,kBAAkB,CAAC,CAAC;QAEtE,MAAM,EAAE,GAAG,SAAS,CAAC,kBAAkB,EAAE,yBAAyB,CAAC,CAAC;QACpE,IAAI,CAAC,EAAE,EAAE,CAAC;YACN,OAAO,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;YACjD,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YAEhC,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;YAC1C,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YAKhC,OAAO,CAAC,GAAG,CAAC,sCAAsC,CAAC,CAAC;YACpD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,kBAAkB,EACvC,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;YAE5E,OAAO,CAAC,GAAG,CAAC,6CAA6C,CAAC,CAAC;YAC3D,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;YAEvC,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;YAChD,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;YAChD,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;QACpD,CAAC;QACD,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,kBAAkB,EAAE,yBAAyB,CAAC,CAAC,CAAC;QAEhF,IAAI,WAAW,CAAC,KAAK,EAAE,CAAC;YACpB,KAAK,MAAM,SAAS,IAAI,WAAW,CAAC,KAAK,EAAE,CAAC;gBACxC,IAAI,SAAS,CAAC,UAAU,IAAI,SAAS,CAAC,UAAU,CAAC,YAAY,EAAE,CAAC;oBAC5D,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;oBAC5B,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;oBAC/C,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;gBACpC,CAAC;gBACD,IAAI,SAAS,CAAC,SAAS,EAAE,CAAC;oBACtB,KAAK,MAAM,OAAO,IAAI,SAAS,CAAC,SAAS,EAAE,CAAC;wBACxC,IAAI,OAAO,CAAC,QAAQ,KAAK,+BAA+B,EAAE,CAAC;4BACvD,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;4BAC1B,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;4BAC9B,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;wBAClC,CAAC;oBACL,CAAC;gBACL,CAAC;gBACD,IAAI,SAAS,CAAC,aAAa,EAAE,CAAC;oBAC1B,MAAM,EAAE,GAAG,SAAS,CAAC,aAAa,CAAC;oBACnC,IAAI,CAAC,EAAE,CAAC,WAAW,EAAE,CAAC;wBAClB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,EACvB,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;oBAChF,CAAC;oBACD,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,aAAa,CAAC,CAAC;oBAE9B,IAAI,CAAC;wBAED,MAAM,IAAA,yCAAqB,EAAC,WAAW,EAAE,EAAE,CAAC,CAAC;oBACjD,CAAC;oBAAC,OAAO,GAAG,EAAE,CAAC;wBAEX,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBAC/B,CAAC;oBAGD,MAAM,SAAS,GAAG,IAAA,8BAAe,EAAC,EAAE,CAAC,CAAC;oBAItC,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;oBAC/D,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,SAAS,CAAC,CAAC;oBAInD,MAAM,SAAS,GAAG,IAAA,gCAAiB,EAAC,SAAS,EAAE,gCAAgB,CAAC,CAAC;oBAGjE,MAAM,gBAAgB,GAAG,IAAA,8BAAe,EAAC,SAAS,CAAC,CAAC;oBAEpD,MAAM,IAAI,GAAG,SAAS,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;oBACpD,IAAI,CAAC,IAAI,EAAE,CAAC;wBACR,OAAO,CAAC,GAAG,CAAC,mCAAmC,CAAC,CAAC;wBACjD,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;wBAEvB,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;wBAC1C,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;wBAKvB,OAAO,CAAC,GAAG,CAAC,sCAAsC,CAAC,CAAC;wBACpD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,EAC9B,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;wBAE5E,OAAO,CAAC,GAAG,CAAC,6CAA6C,CAAC,CAAC;wBAC3D,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;wBAE9B,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;wBAChD,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;wBAChD,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;oBACpD,CAAC;oBACD,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC,CAAC;gBAClE,CAAC;YACL,CAAC;QACL,CAAC;IACL,CAAC;CAAA","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\nimport * as crypto from \"crypto\";\nimport * as deepEqual from \"fast-deep-equal\";\nimport * as fs from \"fs\";\nimport * as jsonDiff from \"json-diff\";\nimport * as path from \"path\";\nimport { URL } from \"url\";\nimport * as util from \"util\";\n\nimport { MediaOverlayNode } from \"@models/media-overlay\";\nimport { Publication } from \"@models/publication\";\nimport { Link } from \"@models/publication-link\";\nimport { AudioBookis, isAudioBookPublication } from \"@parser/audiobook\";\nimport { DaisyBookis, isDaisyPublication } from \"@parser/daisy\";\nimport { convertDaisyToReadiumWebPub } from \"@parser/daisy-convert-to-epub\";\nimport { isEPUBlication } from \"@parser/epub\";\nimport { lazyLoadMediaOverlays } from \"@parser/epub-daisy-common\";\nimport { PublicationParsePromise } from \"@parser/publication-parser\";\nimport { setLcpNativePluginPath } from \"@r2-lcp-js/parser/epub/lcp\";\nimport { JsonArray, JsonMap, TaJsonDeserialize, TaJsonSerialize } from \"@r2-lcp-js/serializable\";\nimport { isHTTP } from \"@r2-utils-js/_utils/http/UrlUtils\";\nimport { streamToBufferPromise } from \"@r2-utils-js/_utils/stream/BufferUtils\";\nimport { IStreamAndLength, IZip } from \"@r2-utils-js/_utils/zip/zip\";\nimport { Transformers } from \"@transform/transformer\";\n\nimport { initGlobalConverters_GENERIC, initGlobalConverters_SHARED } from \"../init-globals\";\nimport { zipHasEntry } from \"./zipHasEntry\";\n\n// import { initGlobalConverters_OPDS } from \"@opds/init-globals\";\n\n// initGlobalConverters_OPDS();\ninitGlobalConverters_SHARED();\ninitGlobalConverters_GENERIC();\n\nsetLcpNativePluginPath(path.join(process.cwd(), \"LCP\", \"lcp.node\"));\n\nconsole.log(\"process.cwd():\");\nconsole.log(process.cwd());\n\nconsole.log(\"__dirname: \");\nconsole.log(__dirname);\n\nconst args = process.argv.slice(2);\nconsole.log(\"args:\");\nconsole.log(args);\n\nif (!args[0]) {\n    console.log(\"FILEPATH ARGUMENT IS MISSING.\");\n    process.exit(1);\n}\nconst argPath = args[0].trim();\nlet filePath = argPath;\nconsole.log(filePath);\n\nif (!isHTTP(filePath)) {\n    if (!fs.existsSync(filePath)) {\n        filePath = path.join(__dirname, argPath);\n        console.log(filePath);\n        if (!fs.existsSync(filePath)) {\n            filePath = path.join(process.cwd(), argPath);\n            console.log(filePath);\n            if (!fs.existsSync(filePath)) {\n                console.log(\"FILEPATH DOES NOT EXIST.\");\n                process.exit(1);\n            }\n        }\n    }\n\n    const stats = fs.lstatSync(filePath);\n    if (!stats.isFile() && !stats.isDirectory()) {\n        console.log(\"FILEPATH MUST BE FILE OR DIRECTORY.\");\n        process.exit(1);\n    }\n}\n\nlet fileName = filePath;\nif (isHTTP(filePath)) {\n    const url = new URL(filePath);\n    fileName = url.pathname;\n}\nfileName = fileName.replace(/META-INF[\\/|\\\\]container.xml$/, \"\");\nfileName = path.basename(fileName);\n\nlet generateDaisyAudioManifestOnly = false;\nlet decryptKeys: string[] | undefined;\nif (args[2]) {\n    if (args[2] === \"generate-daisy-audio-manifest-only\") {\n        generateDaisyAudioManifestOnly = true;\n    } else {\n        decryptKeys = args[2].trim().split(\";\");\n    }\n}\n\nlet outputDirPath: string | undefined;\nif (args[1]) {\n    const argDir = args[1].trim();\n    let dirPath = argDir;\n    console.log(dirPath);\n    if (!fs.existsSync(dirPath)) {\n        dirPath = path.join(__dirname, argDir);\n        console.log(dirPath);\n        if (!fs.existsSync(dirPath)) {\n            dirPath = path.join(process.cwd(), argDir);\n            console.log(dirPath);\n            if (!fs.existsSync(dirPath)) {\n                console.log(\"DIRPATH DOES NOT EXIST.\");\n                process.exit(1);\n            } else {\n                if (!fs.lstatSync(dirPath).isDirectory()) {\n                    console.log(\"DIRPATH MUST BE DIRECTORY.\");\n                    process.exit(1);\n                }\n            }\n        }\n    }\n\n    dirPath = fs.realpathSync(dirPath);\n\n    if (generateDaisyAudioManifestOnly) {\n        outputDirPath = dirPath;\n\n        console.log(outputDirPath);\n\n        // ensureDirs(path.join(outputDirPath, \"DUMMY.txt\"));\n        // if (!fs.existsSync(outputDirPath)) {\n        //     console.log(\"OUTPUT FOLDER DOES NOT EXIST!\");\n        //     process.exit(1);\n        // }\n    } else {\n        const fileNameNoExt = fileName + \"_R2_EXTRACTED\";\n        console.log(fileNameNoExt);\n        outputDirPath = path.join(dirPath, fileNameNoExt);\n\n        console.log(outputDirPath);\n        if (fs.existsSync(outputDirPath)) {\n            console.log(\"OUTPUT FOLDER ALREADY EXISTS!\");\n            process.exit(1);\n        }\n    }\n}\n\n// tslint:disable-next-line:no-floating-promises\n(async () => {\n    let publication: Publication;\n    try {\n        publication = await PublicationParsePromise(filePath);\n    } catch (err) {\n        console.log(\"== Publication Parser: reject\");\n        console.log(err);\n        return;\n    }\n\n    const isAnEPUB = isEPUBlication(filePath);\n    let isAnAudioBook: AudioBookis | undefined;\n    try {\n        isAnAudioBook = await isAudioBookPublication(filePath);\n    } catch (_err) {\n        // console.log(err);\n        // ignore\n    }\n    let isDaisyBook: DaisyBookis | undefined;\n    try {\n        isDaisyBook = await isDaisyPublication(filePath);\n    } catch (_err) {\n        // console.log(err);\n        // ignore\n    }\n\n    if ((isDaisyBook || isAnAudioBook || isAnEPUB) && outputDirPath) {\n        try {\n            if (isDaisyBook) {\n                await convertDaisyToReadiumWebPub(\n                    outputDirPath,\n                    publication,\n                    generateDaisyAudioManifestOnly ? fileName : undefined);\n\n                const isFullTextAudio = publication.Metadata?.AdditionalJSON &&\n                    // dtb:multimediaContent ==> audio,text\n                    (publication.Metadata.AdditionalJSON[\"dtb:multimediaType\"] === \"audioFullText\" ||\n                    publication.Metadata.AdditionalJSON[\"ncc:multimediaType\"] === \"audioFullText\" || (\n                        !publication.Metadata.AdditionalJSON[\"dtb:multimediaType\"] &&\n                        !publication.Metadata.AdditionalJSON[\"ncc:multimediaType\"]\n                    ));\n                if (isFullTextAudio && !publication.Spine?.length) {\n                    console.log(\"%%%%% FAILED audio+text DAISY convert, trying again as audio-only ...\");\n                    publication.freeDestroy();\n                    try {\n                        publication = await PublicationParsePromise(filePath);\n                    } catch (err) {\n                        console.log(\"== Publication Parser: reject\");\n                        console.log(err);\n                        return;\n                    }\n                    // TODO: delete file contents (webpub zip) inside outputDirPath? shouldn't be necessary as fs.createWriteStream() by default overrides, so does fs.writeFileSync() in the case of generateDaisyAudioManifestOnly\n                    await new Promise((reso) => {\n                        setTimeout(async () => {\n                            reso(await convertDaisyToReadiumWebPub(\n                                outputDirPath!,\n                                publication,\n                                generateDaisyAudioManifestOnly ? fileName : undefined,\n                                true));\n                        }, 500);\n                    });\n                }\n            } else {\n                await extractEPUB((isAnEPUB || isDaisyBook) ? true : false, publication, outputDirPath, decryptKeys);\n            }\n        } catch (err) {\n            console.log(\"== Publication extract FAIL\");\n            console.log(err);\n            return;\n        }\n    } else {\n        await dumpPublication(publication);\n    }\n})();\n\nfunction extractEPUB_ManifestJSON(pub: Publication, outDir: string, keys: string[] | undefined) {\n\n    const manifestJson = TaJsonSerialize(pub);\n\n    const arrLinks = [];\n    if (manifestJson.readingOrder) {\n        arrLinks.push(...(manifestJson.readingOrder as JsonArray));\n    }\n    if (manifestJson.resources) {\n        arrLinks.push(...(manifestJson.resources as JsonArray));\n    }\n\n    if (keys) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        arrLinks.forEach((link: any) => {\n            if (link.properties && link.properties.encrypted &&\n                link.properties.encrypted.scheme === \"http://readium.org/2014/01/lcp\") {\n                delete link.properties.encrypted;\n\n                let atLeastOne = false;\n                const jsonProps = Object.keys(link.properties);\n                if (jsonProps) {\n                    jsonProps.forEach((jsonProp) => {\n                        if (link.properties.hasOwnProperty(jsonProp)) {\n                            atLeastOne = true;\n                            return false;\n                        }\n                        return true;\n                    });\n                }\n                if (!atLeastOne) {\n                    delete link.properties;\n                }\n            }\n        });\n        if (manifestJson.links) {\n            const lks = (manifestJson.links as JsonArray);\n            let index = -1;\n            for (let i = 0; i < lks.length; i++) {\n                const link = lks[i] as JsonMap;\n                if (link.type === \"application/vnd.readium.lcp.license.v1.0+json\"\n                    && link.rel === \"license\") {\n                    index = i;\n                    break;\n                }\n            }\n            if (index >= 0) {\n                lks.splice(index, 1);\n            }\n            if (lks.length === 0) {\n                delete manifestJson.links;\n            }\n        }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    arrLinks.forEach((link: any) => {\n        if (link.properties && link.properties.encrypted &&\n            (link.properties.encrypted.algorithm === \"http://www.idpf.org/2008/embedding\" ||\n                link.properties.encrypted.algorithm === \"http://ns.adobe.com/pdf/enc#RC\")) {\n            delete link.properties.encrypted;\n\n            let atLeastOne = false;\n            const jsonProps = Object.keys(link.properties);\n            if (jsonProps) {\n                jsonProps.forEach((jsonProp) => {\n                    if (link.properties.hasOwnProperty(jsonProp)) {\n                        atLeastOne = true;\n                        return false;\n                    }\n                    return true;\n                });\n            }\n            if (!atLeastOne) {\n                delete link.properties;\n            }\n        }\n    });\n\n    const manifestJsonStr = JSON.stringify(manifestJson, null, \"  \");\n    // console.log(manifestJsonStr);\n\n    const manifestJsonPath = path.join(outDir, \"manifest.json\");\n    fs.writeFileSync(manifestJsonPath, manifestJsonStr, \"utf8\");\n}\n\nasync function extractEPUB_Check(zip: IZip, outDir: string) {\n    let zipEntries: string[] | undefined;\n    try {\n        zipEntries = await zip.getEntries();\n    } catch (err) {\n        console.log(err);\n    }\n    if (zipEntries) {\n        for (const zipEntry of zipEntries) {\n            if (zipEntry !== \"mimetype\" &&\n                !zipEntry.startsWith(\"META-INF/\") &&\n                !/\\.opf$/i.test(zipEntry) &&\n                !/ncc\\.html$/i.test(zipEntry) &&\n                zipEntry !== \"publication.json\" &&\n                zipEntry !== \"license.lcpl\" &&\n                !zipEntry.endsWith(\".DS_Store\") &&\n                !zipEntry.startsWith(\"__MACOSX/\")) { // zip entry can actually be exploded EPUB file\n\n                const expectedOutputPath = path.join(outDir, zipEntry);\n                if (!fs.existsSync(expectedOutputPath)) {\n                    console.log(\"Zip entry not extracted??\");\n                    console.log(expectedOutputPath);\n                }\n            }\n        }\n    }\n}\n\nasync function extractEPUB_ProcessKeys(pub: Publication, keys: string[] | undefined) {\n\n    if (!pub.LCP || !keys) {\n        return;\n    }\n\n    const keysSha256Hex = keys.map((key) => {\n        console.log(\"@@@\");\n        console.log(key);\n\n        // sniffing for already-encoded plain-text passphrase\n        // (looking for SHA256 checksum / hex digest)\n        if (key.length === 64) { // 32 bytes\n            let isHex = true;\n            for (let i = 0; i < key.length; i += 2) {\n\n                const hexByte = key.substr(i, 2).toLowerCase();\n\n                const parsedInt = parseInt(hexByte, 16);\n                if (isNaN(parsedInt)) {\n                    isHex = false;\n                    break;\n                }\n\n                // let hexByteCheck = parsedInt.toString(16);\n                // if (hexByteCheck.length === 1) {\n                //     hexByteCheck = \"0\" + hexByteCheck; // pad\n                // }\n                // // console.log(hexByteCheck);\n                // if (hexByteCheck !== hexByte) {\n                //     console.log(hexByte + \" != \" + hexByteCheck);\n                //     isHex = false;\n                //     break;\n                // }\n            }\n            if (isHex) {\n                return key;\n            }\n        }\n\n        const checkSum = crypto.createHash(\"sha256\");\n        checkSum.update(key);\n        const keySha256Hex = checkSum.digest(\"hex\");\n        console.log(keySha256Hex);\n        return keySha256Hex;\n\n        // const lcpPass64 = Buffer.from(hash).toString(\"base64\");\n        // const lcpPassHex = Buffer.from(lcpPass64, \"base64\").toString(\"utf8\");\n    });\n\n    try {\n        await pub.LCP.tryUserKeys(keysSha256Hex);\n    } catch (err) {\n        console.log(err);\n        throw Error(\"FAIL publication.LCP.tryUserKeys()\");\n\n        // DRMErrorCode (from r2-lcp-client)\n        // 1 === NO CORRECT PASSPHRASE / UERKEY IN GIVEN ARRAY\n        //     // No error\n        //     NONE = 0,\n        //     /**\n        //         WARNING ERRORS > 10\n        //     **/\n        //     // License is out of date (check start and end date)\n        //     LICENSE_OUT_OF_DATE = 11,\n        //     /**\n        //         CRITICAL ERRORS > 100\n        //     **/\n        //     // Certificate has been revoked in the CRL\n        //     CERTIFICATE_REVOKED = 101,\n        //     // Certificate has not been signed by CA\n        //     CERTIFICATE_SIGNATURE_INVALID = 102,\n        //     // License has been issued by an expired certificate\n        //     LICENSE_CERTIFICATE_DATE_INVALID (was LICENSE_SIGNATURE_DATE_INVALID) = 111,\n        //     // License signature does not match\n        //     LICENSE_SIGNATURE_INVALID = 112,\n        //     // The drm context is invalid\n        //     CONTEXT_INVALID = 121,\n        //     // Unable to decrypt encrypted content key from user key\n        //     CONTENT_KEY_DECRYPT_ERROR = 131,\n        //     // User key check invalid\n        //     USER_KEY_CHECK_INVALID = 141,\n        //     // Unable to decrypt encrypted content from content key\n        //     CONTENT_DECRYPT_ERROR = 151\n    }\n}\n\nasync function extractEPUB_Link(pub: Publication, zip: IZip, outDir: string, link: Link) {\n\n    const hrefDecoded = link.HrefDecoded;\n    console.log(\"===== \" + hrefDecoded);\n    if (!hrefDecoded) {\n        console.log(\"!?link.HrefDecoded\");\n        return;\n    }\n\n    const has = await zipHasEntry(zip, hrefDecoded, link.Href);\n    if (!has) {\n        console.log(`NOT IN ZIP (extractEPUB_Link): ${link.Href} --- ${hrefDecoded}`);\n        const zipEntries = await zip.getEntries();\n        for (const zipEntry of zipEntries) {\n            if (zipEntry.startsWith(\"__MACOSX/\")) {\n                continue;\n            }\n            console.log(zipEntry);\n        }\n        return;\n    }\n\n    let zipStream_: IStreamAndLength;\n    try {\n        zipStream_ = await zip.entryStreamPromise(hrefDecoded);\n    } catch (err) {\n        console.log(hrefDecoded);\n        console.log(err);\n        return;\n    }\n\n    let transformedStream: IStreamAndLength;\n    try {\n        transformedStream = await Transformers.tryStream(\n            pub, link, undefined,\n            zipStream_,\n            false,\n            0,\n            0,\n            undefined,\n        );\n    } catch (err) {\n        // Note that the \"LCP not ready!\" message is a warning, not an error caught here.\n        console.log(hrefDecoded);\n        console.log(err);\n        return;\n    }\n\n    // if (transformedStream !== zipStream_) {\n    //     console.log(\"(asset transformed)\");\n    // }\n    zipStream_ = transformedStream; // can be unchanged\n\n    let zipData: Buffer;\n    try {\n        zipData = await streamToBufferPromise(zipStream_.stream);\n    } catch (err) {\n        console.log(hrefDecoded);\n        console.log(err);\n        return;\n    }\n    // console.log(\"CHECK: \" + zipStream_.length + \" ==> \" + zipData.length);\n\n    const linkOutputPath = path.join(outDir, hrefDecoded);\n    ensureDirs(linkOutputPath);\n    fs.writeFileSync(linkOutputPath, zipData);\n}\n\nasync function extractEPUB(isEPUB: boolean, pub: Publication, outDir: string, keys: string[] | undefined) {\n\n    // automatically handles exploded filesystem too,\n    // via the zip-ex.ts abstraction in r2-utils-js\n    // returned by zip-factory.ts (zipLoadPromise() function)\n    const zipInternal = pub.findFromInternal(\"zip\");\n    if (!zipInternal) {\n        console.log(\"No publication zip!?\");\n        return;\n    }\n\n    const zip = zipInternal.Value as IZip;\n\n    try {\n        await extractEPUB_ProcessKeys(pub, keys);\n    } catch (err) {\n        console.log(err);\n        throw err;\n    }\n\n    // fs.mkdirSync // { recursive: false }\n    ensureDirs(path.join(outDir, \"DUMMY_FILE.EXT\"));\n\n    try {\n        await extractEPUB_MediaOverlays(pub, zip, outDir);\n    } catch (err) {\n        console.log(err);\n    }\n\n    extractEPUB_ManifestJSON(pub, outDir, keys);\n\n    const links = [];\n    if (pub.Resources) {\n        links.push(...pub.Resources);\n    }\n    if (pub.Spine) { // JSON.readingOrder\n        links.push(...pub.Spine);\n    }\n    // if (await zipHasEntry(zip, \"META-INF/container.xml\", undefined)) {\n    //     const l = new Link();\n    //     l.setHrefDecoded(\"META-INF/container.xml\");\n    //     links.push(l);\n    // }\n    if (!keys) {\n        const lic = (isEPUB ? \"META-INF/\" : \"\") + \"license.lcpl\";\n        const has = await zipHasEntry(zip, lic, undefined);\n        if (has) {\n            const l = new Link();\n            l.setHrefDecoded(lic);\n            links.push(l);\n        }\n    }\n    for (const link of links) {\n        try {\n            await extractEPUB_Link(pub, zip, outDir, link);\n        } catch (err) {\n            console.log(err);\n        }\n    }\n\n    try {\n        await extractEPUB_Check(zip, outDir);\n    } catch (err) {\n        console.log(err);\n    }\n}\n\nasync function extractEPUB_MediaOverlays(pub: Publication, _zip: IZip, outDir: string): Promise<void> {\n\n    if (!pub.Spine) {\n        return;\n    }\n\n    let i = -1;\n    for (const spineItem of pub.Spine) {\n\n        if (spineItem.MediaOverlays) {\n            const mo = spineItem.MediaOverlays;\n            // console.log(util.inspect(mo,\n            //     { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n            // console.log(mo.SmilPathInZip);\n\n            try {\n                // mo.initialized true/false is automatically handled\n                await lazyLoadMediaOverlays(pub, mo);\n            } catch (err) {\n                // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n                return Promise.reject(err);\n            }\n            const moJsonObj = TaJsonSerialize(mo);\n            const moJsonStr = global.JSON.stringify(moJsonObj, null, \"  \");\n\n            i++;\n            const p = `media-overlays_${i}.json`;\n\n            const moJsonPath = path.join(outDir, p);\n            fs.writeFileSync(moJsonPath, moJsonStr, \"utf8\");\n\n            if (spineItem.Properties && spineItem.Properties.MediaOverlay) {\n                spineItem.Properties.MediaOverlay = p;\n            }\n            if (spineItem.Alternate) {\n                for (const altLink of spineItem.Alternate) {\n                    if (altLink.TypeLink === \"application/vnd.syncnarr+json\") {\n                        altLink.Href = p;\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunction ensureDirs(fspath: string) {\n    const dirname = path.dirname(fspath);\n\n    if (!fs.existsSync(dirname)) {\n        ensureDirs(dirname);\n        fs.mkdirSync(dirname);\n    }\n}\n\nasync function dumpPublication(publication: Publication): Promise<void> {\n\n    console.log(\"#### RAW OBJECT:\");\n    // breakLength: 100  maxArrayLength: undefined\n    console.log(util.inspect(publication,\n        { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n\n    const publicationJsonObj = TaJsonSerialize(publication);\n    console.log(util.inspect(publicationJsonObj,\n        { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n\n    const publicationJsonStr = global.JSON.stringify(publicationJsonObj, null, \"  \");\n\n    // const publicationJsonStrCanonical = JSON.stringify(sortObject(publicationJsonObj));\n\n    const publicationReverse = TaJsonDeserialize(publicationJsonObj, Publication);\n    // publicationReverse.AddLink(\"fake type\", [\"fake rel\"], \"fake url\", undefined);\n\n    const publicationJsonObjReverse = TaJsonSerialize(publicationReverse);\n\n    const eq = deepEqual(publicationJsonObj, publicationJsonObjReverse);\n    if (!eq) {\n        console.log(\"#### TA-JSON SERIALIZED JSON OBJ:\");\n        console.log(publicationJsonObj);\n\n        console.log(\"#### STRINGIFIED JSON OBJ:\");\n        console.log(publicationJsonStr);\n\n        // console.log(\"#### CANONICAL JSON:\");\n        // console.log(publicationJsonStrCanonical);\n\n        console.log(\"#### TA-JSON DESERIALIZED (REVERSE):\");\n        console.log(util.inspect(publicationReverse,\n            { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n\n        console.log(\"#### TA-JSON SERIALIZED JSON OBJ (REVERSE):\");\n        console.log(publicationJsonObjReverse);\n\n        console.log(\"#### REVERSE NOT DEEP EQUAL!\\n\\n\");\n        console.log(\"#### REVERSE NOT DEEP EQUAL!\\n\\n\");\n        console.log(\"#### REVERSE NOT DEEP EQUAL!\\n\\n\");\n    }\n    console.log(jsonDiff.diffString(publicationJsonObj, publicationJsonObjReverse));\n\n    if (publication.Spine) {\n        for (const spineItem of publication.Spine) {\n            if (spineItem.Properties && spineItem.Properties.MediaOverlay) {\n                console.log(spineItem.Href); // OPS/chapter_002.xhtml\n                console.log(spineItem.Properties.MediaOverlay); // media-overlay.json?resource=OPS%2Fchapter_002.xhtml\n                console.log(spineItem.Duration); // 543\n            }\n            if (spineItem.Alternate) {\n                for (const altLink of spineItem.Alternate) {\n                    if (altLink.TypeLink === \"application/vnd.syncnarr+json\") {\n                        console.log(altLink.Href); // media-overlay.json?resource=OPS%2Fchapter_002.xhtml\n                        console.log(altLink.TypeLink); // application/vnd.syncnarr+json\n                        console.log(altLink.Duration); // 543\n                    }\n                }\n            }\n            if (spineItem.MediaOverlays) {\n                const mo = spineItem.MediaOverlays;\n                if (!mo.initialized) {\n                    console.log(util.inspect(mo,\n                        { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n                }\n                console.log(mo.SmilPathInZip);\n\n                try {\n                    // mo.initialized true/false is automatically handled\n                    await lazyLoadMediaOverlays(publication, mo);\n                } catch (err) {\n                    // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n                    return Promise.reject(err);\n                }\n                // console.log(util.inspect(mo,\n                //     { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n                const moJsonObj = TaJsonSerialize(mo);\n                // console.log(util.inspect(moJsonObj,\n                //     { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n\n                const moJsonStr = global.JSON.stringify(moJsonObj, null, \"  \");\n                console.log(moJsonStr.substr(0, 1000) + \"\\n...\\n\");\n\n                // const moJsonStrCanonical = JSON.stringify(sortObject(moJsonObj));\n\n                const moReverse = TaJsonDeserialize(moJsonObj, MediaOverlayNode);\n                // moReverse.AddLink(\"fake type\", [\"fake rel\"], \"fake url\", undefined);\n\n                const moJsonObjReverse = TaJsonSerialize(moReverse);\n\n                const equa = deepEqual(moJsonObj, moJsonObjReverse);\n                if (!equa) {\n                    console.log(\"#### TA-JSON SERIALIZED JSON OBJ:\");\n                    console.log(moJsonObj);\n\n                    console.log(\"#### STRINGIFIED JSON OBJ:\");\n                    console.log(moJsonStr);\n\n                    // console.log(\"#### CANONICAL JSON:\");\n                    // console.log(moJsonStrCanonical);\n\n                    console.log(\"#### TA-JSON DESERIALIZED (REVERSE):\");\n                    console.log(util.inspect(moReverse,\n                        { showHidden: false, depth: 1000, colors: true, customInspect: true }));\n\n                    console.log(\"#### TA-JSON SERIALIZED JSON OBJ (REVERSE):\");\n                    console.log(moJsonObjReverse);\n\n                    console.log(\"#### REVERSE NOT DEEP EQUAL!\\n\\n\");\n                    console.log(\"#### REVERSE NOT DEEP EQUAL!\\n\\n\");\n                    console.log(\"#### REVERSE NOT DEEP EQUAL!\\n\\n\");\n                }\n                console.log(jsonDiff.diffString(moJsonObj, moJsonObjReverse));\n            }\n        }\n    }\n}\n"]}