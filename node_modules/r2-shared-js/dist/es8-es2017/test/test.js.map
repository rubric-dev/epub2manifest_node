{"version":3,"file":"test.js","sourceRoot":"","sources":["../../../test/test.ts"],"names":[],"mappings":"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","sourcesContent":["import test from \"ava\";\nimport * as debug_ from \"debug\";\nimport * as fs from \"fs\";\nimport * as jsonDiff from \"json-diff\";\nimport * as path from \"path\";\n\nimport { timeStrToSeconds } from \"@models/media-overlay\";\nimport { Publication } from \"@models/publication\";\nimport { PublicationParsePromise } from \"@parser/publication-parser\";\nimport { TaJsonDeserialize, TaJsonSerialize } from \"@r2-lcp-js/serializable\";\n\nimport { initGlobalConverters_GENERIC, initGlobalConverters_SHARED } from \"../src/init-globals\";\n\n// import * as filehound from \"filehound\";\n\ninitGlobalConverters_SHARED();\ninitGlobalConverters_GENERIC();\n\nconst debug = debug_(\"r2:shared#test\");\n\n// ==========================\n\nasync function fn() {\n    return Promise.resolve(\"foo\");\n}\ntest(\"dummy async test\", async (t) => {\n    debug(\"test ASYNC\");\n    t.is(await fn(), \"foo\");\n});\n\n// ==========================\n\ntest(\"SMIL clock values\", (t) => {\n    t.plan(16);\n\n    t.is(timeStrToSeconds(\"12.345\"), 12.345);\n    t.is(timeStrToSeconds(\"2345ms\"), 2.345);\n    t.is(timeStrToSeconds(\"345ms\"), 0.345);\n    t.is(timeStrToSeconds(\"7.75h\"), 27900);\n    t.is(timeStrToSeconds(\"76.2s\"), 76.2);\n    t.is(timeStrToSeconds(\"00:56.78\"), 56.78);\n    t.is(timeStrToSeconds(\"09:58\"), 598);\n    t.is(timeStrToSeconds(\"09.5:58\"), 628);\n    t.is(timeStrToSeconds(\"0:00:04\"), 4);\n    t.is(timeStrToSeconds(\"0:05:01.2\"), 301.2);\n    t.is(timeStrToSeconds(\"124:59:36\"), 449976);\n    t.is(timeStrToSeconds(\"5:34:31.396\"), 20071.396);\n    t.is(timeStrToSeconds(\"5:34.5:31.396\"), 20101.396);\n\n    t.is(timeStrToSeconds(\"7.5z\"), 7.5);\n    t.is(timeStrToSeconds(\"4:5:34:31.396\"), 0);\n    t.is(timeStrToSeconds(\"\"), 0);\n});\n\n// ==========================\n\nasync function delay(okay: boolean): Promise<boolean> {\n    return new Promise((resolve, _reject) => {\n        setTimeout(() => {\n            resolve(okay);\n        }, 1000);\n    });\n}\n\ntest(\"EPUB parsing (de)serialize roundtrip\", async (t) => {\n\n    const dirPath = path.join(process.cwd(), \"misc/epubs/\");\n\n    // const filePaths: string[] = await filehound.create()\n    //     .discard(\"node_modules\")\n    //     .depth(5)\n    //     .paths(dirPath)\n    //     .ext([\".epub\", \".epub3\"])\n    //     .find();\n    const filePaths = fs.readdirSync(dirPath, { withFileTypes: true }).\n        filter((f) => f.isFile() && /\\.epub3?$/i.test(f.name)).map((f) => path.join(dirPath, f.name));\n\n    for (const filePath of filePaths) {\n        debug(\"------------------------\");\n        debug(filePath);\n        // debug(\"------------------------\");\n\n        let pub: Publication;\n        try {\n            pub = await PublicationParsePromise(filePath);\n        } catch (err) {\n            console.log(err);\n            continue;\n        }\n        const publicationJson1 = TaJsonSerialize(pub);\n        const publication = TaJsonDeserialize<Publication>(publicationJson1, Publication);\n        const publicationJson2 = TaJsonSerialize(publication);\n\n        const str1 = JSON.stringify(publicationJson1, null, 2);\n        const str2 = JSON.stringify(publicationJson2, null, 2);\n\n        if (str1 !== str2) {\n            process.stdout.write(\"###########################\\n\");\n            process.stdout.write(\"###########################\\n\");\n            process.stdout.write(\"#### JSON DIFF\\n\");\n            process.stdout.write(jsonDiff.diffString(publicationJson1, publicationJson2) + \"\\n\");\n            process.stdout.write(\"###########################\\n\");\n            process.stdout.write(\"###########################\\n\");\n\n            t.true(await delay(false));\n            return;\n        }\n    }\n\n    t.true(await delay(true));\n});\n"]}